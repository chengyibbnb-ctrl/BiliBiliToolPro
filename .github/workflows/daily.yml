name: Daily Bilibili Job

on:
  workflow_dispatch: # å…è®¸æ‰‹åŠ¨è§¦å‘
  schedule:
    - cron: '0 0 * * *' # æ¯å¤© UTC 0:00 - 4:00 (å¯¹åº”åŒ—äº¬æ—¶é—´ 8:00 - 12:00) çš„æ•´ç‚¹è§¦å‘

jobs:
  run-bilibili-task:
    runs-on: ubuntu-latest
    timeout-minutes: 30
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup .NET
        uses: actions/setup-dotnet@v4
        with:
          dotnet-version: '8.0.x'

      - name: Restore dependencies
        run: dotnet restore

      - name: Build
        run: dotnet build --configuration Release --no-restore

      - name: Run Bilibili Tool
        run: dotnet run --configuration Release --no-build --project ./src/Ray.BiliBiliTool.Console
        env:
          RAY_BILIBILITOOLPRO__0: ${{ secrets.RAY_BILIBILITOOLPRO__0 }}
          # ğŸ‘‡ æ–°å¢è¿™ä¸€è¡Œï¼ŒæŠŠä½ çš„ Cookie å¯†é’¥æ³¨å…¥åˆ°ç¯å¢ƒå˜é‡
          RAY_BILIBILICOOKIES__0: ${{ secrets.RAY_BILIBILICOOKIES__0 }}

      - name: Send notification to ServerChan
        run: |
          curl -s "https://sc.ftqq.com/${{ secrets.SERVERCHAN_KEY }}.send?text=ç­¾åˆ°å®Œæˆ&desp=ä½ çš„Bç«™ç­¾åˆ°ä»»åŠ¡å·²ç»å®Œæˆï¼"
        if: success()  # åªæœ‰ä»»åŠ¡æˆåŠŸæ—¶æ‰ä¼šå‘é€é€šçŸ¥
